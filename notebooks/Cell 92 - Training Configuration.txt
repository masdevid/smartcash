# Cell 9.2: Training Configuration (refactored)

import os
import pickle
import yaml
from pathlib import Path

# Import modules
try:
    from smartcash.utils.logger import get_logger
    from smartcash.ui_components.training_components import create_training_config_ui
    from smartcash.handlers.ui_handlers.training_handlers import setup_training_config_handlers
    
    logger = get_logger("training_config", log_to_console=True, log_to_file=True, log_to_colab=True)
except Exception as e:
    print(f"⚠️ Error saat import modul: {str(e)}")
    import logging
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    logger = logging.getLogger("training_config")

# Load training components if available
try:
    with open('training_components.pkl', 'rb') as f:
        components = pickle.load(f)
    
    # Load config
    with open('config.pkl', 'rb') as f:
        config = pickle.load(f)
        
except Exception as e:
    logger.warning(f"⚠️ Komponen training belum diinisialisasi: {str(e)}")
    logger.info("ℹ️ Jalankan Cell 9.1 terlebih dahulu untuk menginisialisasi pipeline")
    
    # Try to load just the config file
    try:
        with open('config.pkl', 'rb') as f:
            config = pickle.load(f)
    except:
        # Fallback to minimal config
        config = {}
    
    components = {}

# Create UI components
ui_components = create_training_config_ui(config)

# Setup handlers for UI components
setup_training_config_handlers(ui_components, config, logger, components)

# Display UI
from IPython.display import display
display(ui_components['ui'])