# Cell 60: Dataset - Download Dataset (refactored)
import os
import yaml
from pathlib import Path
from IPython.display import display
import sys

# Import UI components and handlers
from smartcash.ui_components.dataset_components import create_dataset_ui
from smartcash.handlers.ui_handlers.dataset_handlers import setup_dataset_handlers
from smartcash.utils.roboflow_downloader import download_dataset_from_roboflow, RoboflowDownloader

# Check if running in Google Colab
def is_colab():
    try:
        import google.colab
        return True
    except ImportError:
        return False

# Mount Google Drive if in Colab
drive_path = None
if is_colab():
    try:
        from google.colab import drive
        drive.mount('/content/drive')
        drive_path = '/content/drive/MyDrive/SmartCash'
        # Create SmartCash directory in Drive if it doesn't exist
        os.makedirs(drive_path, exist_ok=True)
        print(f"✅ Google Drive mounted at {drive_path}")
    except Exception as e:
        print(f"⚠️ Failed to mount Google Drive: {str(e)}")
        drive_path = None
else:
    print("ℹ️ Not running in Google Colab. Using local storage.")

# Create and display the dataset UI
dataset_ui = create_dataset_ui(drive_path=drive_path, is_colab=is_colab())
setup_dataset_handlers(
    dataset_ui,
    roboflow_downloader=RoboflowDownloader,
    drive_path=drive_path
)

display(dataset_ui['ui'])