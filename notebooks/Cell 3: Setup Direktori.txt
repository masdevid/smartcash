# Cell 3: Setup Direktori dengan Google Drive Integration
from google.colab import drive
import os
from pathlib import Path

# Coba mount Google Drive
try:
    # Cek apakah Google Drive sudah di-mount
    drive_path = Path('/content/drive')
    if not drive_path.exists() or not (drive_path / 'MyDrive').exists():
        print("ğŸ”„ Mencoba mount Google Drive...")
        drive.mount('/content/drive')
        print("âœ… Google Drive berhasil di-mount!")
    else:
        print("âœ… Google Drive sudah di-mount sebelumnya.")
    
    # Buat direktori di Google Drive
    base_dir = '/content/drive/MyDrive/SmartCash'
    print(f"ğŸ“‚ Menggunakan direktori data di Google Drive: {base_dir}")
    
    # Buat struktur direktori di Google Drive
    os.makedirs(f"{base_dir}/data/train/images", exist_ok=True)
    os.makedirs(f"{base_dir}/data/train/labels", exist_ok=True)
    os.makedirs(f"{base_dir}/data/valid/images", exist_ok=True)
    os.makedirs(f"{base_dir}/data/valid/labels", exist_ok=True)
    os.makedirs(f"{base_dir}/data/test/images", exist_ok=True)
    os.makedirs(f"{base_dir}/data/test/labels", exist_ok=True)
    os.makedirs(f"{base_dir}/configs", exist_ok=True)
    os.makedirs(f"{base_dir}/runs/train/weights", exist_ok=True)
    os.makedirs(f"{base_dir}/logs", exist_ok=True)
    
    # Buat symlink untuk akses yang lebih mudah
    if not os.path.exists('data'):
        print("ğŸ”„ Membuat symlink ke direktori Google Drive...")
        os.symlink(f"{base_dir}/data", 'data')
    if not os.path.exists('configs'):
        os.symlink(f"{base_dir}/configs", 'configs')
    if not os.path.exists('runs'):
        os.symlink(f"{base_dir}/runs", 'runs')
    if not os.path.exists('logs'):
        os.symlink(f"{base_dir}/logs", 'logs')
    
    print("âœ… Struktur direktori berhasil dibuat di Google Drive!")
    
except Exception as e:
    print(f"âš ï¸ Tidak dapat menggunakan Google Drive: {str(e)}")
    print("ğŸ”„ Beralih ke direktori lokal sebagai fallback...")
    
    # Fallback ke direktori lokal
    base_dir = os.getcwd()
    print(f"ğŸ“‚ Menggunakan direktori data lokal: {base_dir}")
    
    # Setup direktori lokal (kode asli)
    os.makedirs(f"{base_dir}/data/train/images", exist_ok=True)
    os.makedirs(f"{base_dir}/data/train/labels", exist_ok=True)
    os.makedirs(f"{base_dir}/data/valid/images", exist_ok=True)
    os.makedirs(f"{base_dir}/data/valid/labels", exist_ok=True)
    os.makedirs(f"{base_dir}/data/test/images", exist_ok=True)
    os.makedirs(f"{base_dir}/data/test/labels", exist_ok=True)
    os.makedirs(f"{base_dir}/configs", exist_ok=True)
    os.makedirs(f"{base_dir}/runs/train/weights", exist_ok=True)
    os.makedirs(f"{base_dir}/logs", exist_ok=True)
    
    print("âœ… Struktur direktori lokal berhasil dibuat!")

# Simpan path base direktori untuk digunakan di cell lain
import pickle
with open('base_dir.pkl', 'wb') as f:
    pickle.dump(base_dir, f)

print(f"ğŸ” Base direktori yang digunakan: {base_dir}")